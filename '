import React from 'react'
import { IEventState, IDay, IEvent, IBoard } from '../types/calendo'

/**
 * Perform shallow equality by iterating through keys on an object and returning false
 * when any key has values that are not strictly equal.
 * Unsupported natively nor in Lodash, so this will do.
 *
 * This does not currently support all edge-case for shallow equality (e.g., invalid inputs, reference equality)
 */
export function isShallowEqual(obj1: Object, obj2: Object) {
    const keysA = Object.keys(obj1)
    const keysB = Object.keys(obj2)
    if (keysA.length !== keysB.length) {
        return false
    }
    for (let i = 0; i < keysA.length; i++) {
        console.log(obj1, obj2)
        if (
            !Object.prototype.hasOwnProperty.call(obj2, keysA[i]) ||
            obj1[keysA[i]] !== obj2[keysA[i]]
        ) {
            return false
        }
    }
    return true
}

export function hashDate(date: Date) {
    return (+date).toString(36);
}

export function useEvent() {
    const defaultEventState: IEventState = {
        dragging: undefined,
        carrying: undefined,
        modal: false,
        isDragging: false,
        isCarrying: false,
        modalEvent: undefined
    }
    const [eventState, setEventState] = React.useState<IEventState>(defaultEventState)
    return {eventState, setEventState}
}

export function getThreshold(height: number): number {
    return Math.max(12, height * 0.1)
}

export function locateDay(date: Date, context: IBoard): IDay | undefined {
    return context.eventDayCollection[hashDate(date)]
}

export function getCalendarInfo() {
    const calendarRoot = document.getElementById('calendar_root')
    const LEFT_OFFSET = calendarRoot.offsetLeft 
    const TOP_OFFSET = calendarRoot.offsetTop 
    const SCROLL_OFFSET = calendarRoot.scrollTop
    const WIDTH = calendarRoot.offsetWidth
    return {
        LEFT_OFFSET,
        TOP_OFFSET,
        SCROLL_OFFSET,
        WIDTH
    } 
}



